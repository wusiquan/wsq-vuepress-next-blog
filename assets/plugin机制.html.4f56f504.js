import{_ as s,o as n,c as a,e as l}from"./app.08d597d0.js";const p={},e=l(`<h1 id="plugin\u673A\u5236" tabindex="-1"><a class="header-anchor" href="#plugin\u673A\u5236" aria-hidden="true">#</a> plugin\u673A\u5236</h1><p>@vuepress/core/src/pluginApi/creatPluginApi\u6A21\u5757\u4E3B\u8981\u662F\u5BFC\u51FA3\u4E2A\u5BF9\u8C61plugins, hooks, registerHooks</p><ol><li><p>plugins\u5BF9\u8C61\u7684\u521B\u5EFA<br><code>const plugins: PluginApi[&#39;plugins&#39;] = []</code></p></li><li><p>hooks\u5BF9\u8C61\u7684\u521B\u5EFA<br><code>const hooks = createPluginApiHooks()</code></p></li></ol><p>pluginApi/createPluginApiHook\u65B9\u6CD5\uFF0C\u8FD4\u56DE\u4E00\u4E2A\u7C7B\u578B\u4E3A<code>[K in HooksName]: HookQueue&lt;K&gt;</code>\u7684\u5BF9\u8C61\uFF0C\u5176\u5185\u90E8\u4F1A\u8C03\u7528<code>createHookQueue</code></p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#282A36;"><code><span class="line"><span style="color:#F286C4;">export</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createPluginApiHooks</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> ()</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PluginApi</span><span style="color:#F6F6F4;">[</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">hooks</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">] </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> ({</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// life cycle hooks</span></span>
<span class="line"><span style="color:#F6F6F4;">  onInitialized</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">onInitialized</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  onPrepared</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">onPrepared</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  onWatched</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">onWatched</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  onGenerated</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">onGenerated</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// page hooks</span></span>
<span class="line"><span style="color:#F6F6F4;">  extendsPageOptions</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">extendsPageOptions</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  extendsPageData</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">extendsPageData</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// markdown hooks</span></span>
<span class="line"><span style="color:#F6F6F4;">  extendsMarkdown</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">extendsMarkdown</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// client files hooks</span></span>
<span class="line"><span style="color:#F6F6F4;">  clientAppEnhanceFiles</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">clientAppEnhanceFiles</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  clientAppRootComponentFiles</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">clientAppRootComponentFiles</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  clientAppSetupFiles</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">clientAppSetupFiles</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// bundler hooks</span></span>
<span class="line"><span style="color:#F6F6F4;">  alias</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">alias</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">  define</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createHookQueue</span><span style="color:#F6F6F4;">(</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">define</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">),</span></span>
<span class="line"><span style="color:#F6F6F4;">})</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>registerHooks\u51FD\u6570\u7684\u521B\u5EFA<br><code>const registerHooks = createPluginApiRegisterHooks(plugins, hooks)</code> createPluginApiRegisterHooks\u662F\u51FD\u6570\u7684\u51FD\u6570\uFF0C\u5373\u8C03\u7528\u540E\u8FD4\u56DE\u4E00\u4E2A\u65E0\u53C2\u6570\u7684\u51FD\u6570\uFF0C\u8FD9\u91CC\u7528\u4E8E\u5EF6\u8FDF\u8C03\u7528</li></ol><p>\u5176\u91CC\u9762\u7684\u51FD\u6570\u4E3B\u8981\u662F\u904D\u5386plugins\u5BF9\u8C61\uFF0C\u5BF9\u5404\u79CD\u7C7B\u578BhookQueue\u8FDB\u884Cnormalize\u540Eadd\uFF0C\u5176\u4E2DcommonHooks\u662F\u5355\u4E2Aplugin\u5BF9\u8C61\u4E2D\u5176\u4F59\u5C5E\u6027(\u6CA1\u6709\u524D\u9762\u7684name, alias, define...)\u7EC4\u6210\u7684\u5BF9\u8C61</p><p>add\u65B9\u6CD5\u7684\u53C2\u6570\u5BF9\u8C61\u5176\u5B9E\u5C31\u662F\u8FD9\u91CC\u6240\u8C13\u7684hookItem</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#282A36;"><code><span class="line"><span style="color:#F286C4;">export</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createPluginApiRegisterHooks</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> (</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#FFB86C;font-style:italic;">plugins</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PluginApi</span><span style="color:#F6F6F4;">[</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">plugins</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">],</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#FFB86C;font-style:italic;">hooks</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PluginApi</span><span style="color:#F6F6F4;">[</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">hooks</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">]</span></span>
<span class="line"><span style="color:#F6F6F4;">)</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">PluginApi</span><span style="color:#F6F6F4;">[</span><span style="color:#DEE492;">&#39;</span><span style="color:#E7EE98;">registerHooks</span><span style="color:#DEE492;">&#39;</span><span style="color:#F6F6F4;">] </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> () </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  plugins.</span><span style="color:#62E884;">forEach</span><span style="color:#F6F6F4;">(</span></span>
<span class="line"><span style="color:#F6F6F4;">    ({</span></span>
<span class="line"><span style="color:#F6F6F4;">      name</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> pluginName,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      alias,</span></span>
<span class="line"><span style="color:#F6F6F4;">      define,</span></span>
<span class="line"><span style="color:#F6F6F4;">      clientAppEnhanceFiles,</span></span>
<span class="line"><span style="color:#F6F6F4;">      clientAppRootComponentFiles,</span></span>
<span class="line"><span style="color:#F6F6F4;">      clientAppSetupFiles,</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">...</span><span style="color:#F6F6F4;">commonHooks</span></span>
<span class="line"><span style="color:#F6F6F4;">    }) </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">       * hooks that need to be normalized</span></span>
<span class="line"><span style="color:#7B7F8B;">       */</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (alias) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        hooks.alias.</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">          pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">          hook</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">normalizeReturnObjectHook</span><span style="color:#F6F6F4;">(alias),</span></span>
<span class="line"><span style="color:#F6F6F4;">        })</span></span>
<span class="line"><span style="color:#F6F6F4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (define) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        hooks.define.</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">          pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">          hook</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">normalizeReturnObjectHook</span><span style="color:#F6F6F4;">(define),</span></span>
<span class="line"><span style="color:#F6F6F4;">        })</span></span>
<span class="line"><span style="color:#F6F6F4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (clientAppEnhanceFiles) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        hooks.clientAppEnhanceFiles.</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">          pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">          hook</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">normalizeClientFilesHook</span><span style="color:#F6F6F4;">(clientAppEnhanceFiles),</span></span>
<span class="line"><span style="color:#F6F6F4;">        })</span></span>
<span class="line"><span style="color:#F6F6F4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (clientAppRootComponentFiles) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        hooks.clientAppRootComponentFiles.</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">          pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">          hook</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">normalizeClientFilesHook</span><span style="color:#F6F6F4;">(clientAppRootComponentFiles),</span></span>
<span class="line"><span style="color:#F6F6F4;">        })</span></span>
<span class="line"><span style="color:#F6F6F4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (clientAppSetupFiles) {</span></span>
<span class="line"><span style="color:#F6F6F4;">        hooks.clientAppSetupFiles.</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">          pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">          hook</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">normalizeClientFilesHook</span><span style="color:#F6F6F4;">(clientAppSetupFiles),</span></span>
<span class="line"><span style="color:#F6F6F4;">        })</span></span>
<span class="line"><span style="color:#F6F6F4;">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#7B7F8B;">/**</span></span>
<span class="line"><span style="color:#7B7F8B;">       * common hooks</span></span>
<span class="line"><span style="color:#7B7F8B;">       */</span></span>
<span class="line"><span style="color:#F6F6F4;">      </span><span style="color:#97E1F1;font-style:italic;">Object</span><span style="color:#F6F6F4;">.</span><span style="color:#62E884;">entries</span><span style="color:#F6F6F4;">(commonHooks).</span><span style="color:#62E884;">forEach</span><span style="color:#F6F6F4;">(([</span><span style="color:#FFB86C;font-style:italic;">key</span><span style="color:#F6F6F4;">, </span><span style="color:#FFB86C;font-style:italic;">hook</span><span style="color:#F6F6F4;">]) </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">        </span><span style="color:#F286C4;">if</span><span style="color:#F6F6F4;"> (hooks[key] </span><span style="color:#F286C4;">&amp;&amp;</span><span style="color:#F6F6F4;"> hook) {</span></span>
<span class="line"><span style="color:#F6F6F4;">          hooks[key].</span><span style="color:#62E884;">add</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">            pluginName,</span></span>
<span class="line"><span style="color:#F6F6F4;">            hook,</span></span>
<span class="line"><span style="color:#F6F6F4;">          })</span></span>
<span class="line"><span style="color:#F6F6F4;">        }</span></span>
<span class="line"><span style="color:#F6F6F4;">      })</span></span>
<span class="line"><span style="color:#F6F6F4;">    }</span></span>
<span class="line"><span style="color:#F6F6F4;">  )</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5BF9\u4E8Edev\u547D\u4EE4<br> @vuepress/cli/src/commands/dev/createDev\u5BFC\u51FA\u7684createDev\u65B9\u6CD5</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#282A36;"><code><span class="line"><span style="color:#F286C4;">export</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createDev</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> (</span><span style="color:#FFB86C;font-style:italic;">defaultAppConfig</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">Partial</span><span style="color:#F6F6F4;">&lt;</span><span style="color:#FFB86C;font-style:italic;">AppConfig</span><span style="color:#F6F6F4;">&gt;)</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">DevCommand</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// create vuepress app</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> app </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createDevApp</span><span style="color:#F6F6F4;">({</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// allow setting default app config via \`cli()\`</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// for example, set different default bundler in \`vuepress\` and \`vuepress-vite\` package</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">...</span><span style="color:#F6F6F4;">defaultAppConfig,</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// use cli options to override config file</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">...</span><span style="color:#F6F6F4;">userConfig,</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#F286C4;">...</span><span style="color:#F6F6F4;">cliAppConfig,</span></span>
<span class="line"><span style="color:#F6F6F4;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// use user-config plugin</span></span>
<span class="line"><span style="color:#F6F6F4;">  app.</span><span style="color:#62E884;">use</span><span style="color:#F6F6F4;">(</span><span style="color:#62E884;">transformUserConfigToPlugin</span><span style="color:#F6F6F4;">(app, userConfig))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">await</span><span style="color:#F6F6F4;"> app.</span><span style="color:#62E884;">init</span><span style="color:#F6F6F4;">()</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">await</span><span style="color:#F6F6F4;"> app.</span><span style="color:#62E884;">prepare</span><span style="color:#F6F6F4;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5B83\u4F1AcreateDev -&gt; createDevApp -&gt; createBaseApp<br> \u800CcreateBaseApp\u65B9\u6CD5\u4E2D\u4F1Aapp.use\u4E3B\u9898\u7684plugins\u4EE5\u53CAoptions.plugins\u4E2D\u7684plugin</p><div class="language-typescript ext-ts line-numbers-mode"><pre class="shiki" style="background-color:#282A36;"><code><span class="line"><span style="color:#F286C4;">export</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">createBaseApp</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> (</span><span style="color:#FFB86C;font-style:italic;">config</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">AppConfig</span><span style="color:#F6F6F4;">, </span><span style="color:#FFB86C;font-style:italic;">isBuild</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#BF9EEE;">false</span><span style="color:#F6F6F4;">)</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">App</span><span style="color:#F6F6F4;"> </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> app </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> {</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#7B7F8B;">// ...</span></span>
<span class="line"><span style="color:#F6F6F4;">    writeTemp,</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">use</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> (</span><span style="color:#F286C4;">...</span><span style="color:#FFB86C;font-style:italic;">args</span><span style="color:#F6F6F4;">) </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">appUse</span><span style="color:#F6F6F4;">(app, </span><span style="color:#F286C4;">...</span><span style="color:#F6F6F4;">args),</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">init</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> () </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">appInit</span><span style="color:#F6F6F4;">(app),</span></span>
<span class="line"><span style="color:#F6F6F4;">    </span><span style="color:#62E884;">prepare</span><span style="color:#F286C4;">:</span><span style="color:#F6F6F4;"> () </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">appPrepare</span><span style="color:#F6F6F4;">(app),</span></span>
<span class="line"><span style="color:#F6F6F4;">  } </span><span style="color:#F286C4;">as</span><span style="color:#F6F6F4;"> </span><span style="color:#97E1F1;font-style:italic;">App</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// resolve theme info and use theme plugins</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> themeInfo </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">resolveThemeInfo</span><span style="color:#F6F6F4;">(app, options.theme)</span></span>
<span class="line"><span style="color:#F6F6F4;">  themeInfo.plugins.</span><span style="color:#62E884;">forEach</span><span style="color:#F6F6F4;">((</span><span style="color:#FFB86C;font-style:italic;">plugin</span><span style="color:#F6F6F4;">) </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> app.</span><span style="color:#62E884;">use</span><span style="color:#F6F6F4;">(plugin))</span></span>
<span class="line"><span style="color:#F6F6F4;">  app.layouts </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> themeInfo.layouts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#7B7F8B;">// resolve plugins</span></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">const</span><span style="color:#F6F6F4;"> plugins </span><span style="color:#F286C4;">=</span><span style="color:#F6F6F4;"> </span><span style="color:#62E884;">resolvePluginsFromConfig</span><span style="color:#F6F6F4;">(app, options.plugins)</span></span>
<span class="line"><span style="color:#F6F6F4;">  plugins.</span><span style="color:#62E884;">forEach</span><span style="color:#F6F6F4;">((</span><span style="color:#FFB86C;font-style:italic;">plugin</span><span style="color:#F6F6F4;">) </span><span style="color:#F286C4;">=&gt;</span><span style="color:#F6F6F4;"> app.</span><span style="color:#62E884;">use</span><span style="color:#F6F6F4;">(plugin))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F6F6F4;">  </span><span style="color:#F286C4;">return</span><span style="color:#F6F6F4;"> app</span></span>
<span class="line"><span style="color:#F6F6F4;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728appUse\u4E2D<code>app.pluginApi.plugins.push(plugin)</code></p><p>\u56DE\u5230createDev\u65B9\u6CD5\u4F1A\u7EE7\u7EED<code>app.use(transformUserConfigToPlugin(app, userConfig))</code>\uFF0C\u4ED6\u5C06userConfig\u5BF9\u8C61\u5373config.ts\u4E2D\u5B9A\u4E49\u7684\u5BF9\u8C61\u4E5F\u8F6C\u6210\u4E86plugin\u5BF9\u8C61(\u5176\u5B9E\u4E5F\u5C31\u52A0name\u5C5E\u6027, \u68C0\u67E5clientAppEnhanceFiles\u5C5E\u6027, \u89C1transformUserConfigToPlugin\u65B9\u6CD5) \u518D\u8C03\u7528app.init()\uFF0C\u800C\u5B83\u5728appInit\u4E2D\u4F1A\u8C03\u7528<code>app.pluginApi.registerHooks()</code></p><p>*\u6240\u4EE5app.use\u662F\u51B3\u5B9Aapp.pluginApi.plugins\u5BF9\u8C61, *</p><p>\u4E00\u53E5\u8BDD\u63CF\u8FF0: createPluginApiHooks\u65B9\u6CD5\u521B\u5EFAhooks\uFF0C\u4E3A\u5B9A\u4E49\u597D\u7684\u4E00\u4E9B\u7C7B\u578B\u7684hookQueue\uFF0C\u5176\u4E2DhookQueue\u53EF\u7406\u89E3\u4E3A\u4E00\u4E2A\u6570\u7EC4(\u5B9E\u9645\u662Fname, items\u5C5E\u6027\u4EE5\u53CAadd, process\u65B9\u6CD5\u7EC4\u6210\u7684\u5BF9\u8C61), \u7136\u540E\u5728createDev-&gt;createDevApp-&gt;createBaseApp\u3001createBuild-&gt;createBuildApp-&gt;createBaseApp\u65F6app.use\u5C06app.pluginApi.plugins.push(plugin), \u63A5\u7740app.init\u65F6\u8C03\u7528app.pluginApi.registerHooks()\uFF0C\u904D\u5386plugins\u4E3A\u5404\u79CDhookQueue.add(\u5373\u6CE8\u518C)hookItem\uFF0C\u8FD9\u6837\u5C31\u53EF\u4EE5\u5728\u5404\u4E2A\u65F6\u673A\u8C03\u7528\u5BF9\u5E94hookQueue.process\u65B9\u6CD5</p>`,17),o=[e];function F(c,i){return n(),a("div",null,o)}var t=s(p,[["render",F],["__file","plugin\u673A\u5236.html.vue"]]);export{t as default};
